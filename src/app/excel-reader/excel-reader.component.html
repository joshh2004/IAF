<!-- ⭐ HORIZONTAL UPLOAD ROW -->
<div class="upload-row">
  
  <!-- Excel Upload -->
  <div class="upload-box">
    <h3>Select Excel File</h3>
    <input type="file" (change)="onFileSelected($event)" accept=".xlsx,.xls" />
  </div>

  <!-- Video Upload -->
  <div class="upload-box">
    <h3>Upload Trip Video</h3>
    <input type="file" accept="video/*" (change)="onVideoUpload($event)">
  </div>

</div>



<div *ngIf="headingVisible" class="result-container">

  <!-- ⭐ ROW 1: Driving Assessment + Driver Score -->
  <div class="row">
    <div class="col">
      <div class="card">
        <h1 class="heading">Driving Assessment</h1>

        <div class="trip-summary">
          <p><strong>Date:</strong> {{ convertExcelDate(getFirst('date')) }}</p>
          <p><strong>Total Time:</strong> {{ getFirst('total time') }}</p>
          <p><strong>Distance:</strong> {{ getFirst('distance') }}</p>

          <p *ngIf="videoLengthSeconds">
            <strong>Video Length:</strong>
            {{ (videoLengthSeconds/3600) >= 1
              ? (Math.floor(videoLengthSeconds/3600) + 'h ' + Math.floor((videoLengthSeconds%3600)/60) + 'm')
              : (Math.floor(videoLengthSeconds/60) + 'm') }}
          </p>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="card chart-area">
        <h2 class="score-title">Driver Score</h2>

        <!-- Your donut SVG remains unchanged -->
        <svg width="220" height="220" viewBox="0 0 220 220">
          <!-- arcs -->
          <circle cx="110" cy="110" r="80" stroke="red" stroke-width="15"
            fill="transparent"
            [attr.stroke-dasharray]="redArc + ' ' + (totalCircumference - redArc)"
            stroke-linecap="round"
            transform="rotate(-90 110 110)"
          ></circle>

          <circle cx="110" cy="110" r="80" stroke="blue" stroke-width="15"
            fill="transparent"
            [attr.stroke-dasharray]="blueArc + ' ' + (totalCircumference - blueArc)"
            [attr.stroke-dashoffset]="-redArc"
            stroke-linecap="round"
            transform="rotate(-90 110 110)"
          ></circle>

          <circle cx="110" cy="110" r="80" stroke="green" stroke-width="15"
            fill="transparent"
            [attr.stroke-dasharray]="greenArc + ' ' + (totalCircumference - greenArc)"
            [attr.stroke-dashoffset]="-(redArc + blueArc)"
            stroke-linecap="round"
            transform="rotate(-90 110 110)"
          ></circle>

          <circle cx="110" cy="110" r="80" stroke="#e6e6e6" stroke-width="15"
            fill="transparent"
            [attr.stroke-dasharray]="emptyArc + ' ' + (totalCircumference - emptyArc)"
            [attr.stroke-dashoffset]="-(redArc + blueArc + greenArc)"
            stroke-linecap="round"
            transform="rotate(-90 110 110)"
          ></circle>

          <text x="110" y="118" text-anchor="middle" class="score-text">{{ driverScore }}</text>
          <text x="110" y="145" text-anchor="middle" class="score-label">{{ getScoreLabel() }}</text>
        </svg>
      </div>
    </div>
  </div>


  <!-- ⭐ ROW 2: Events During Trip + Trip Report -->
  <div class="row">
    <div class="col">
      <div class="card">
        <h3>Events During Trip</h3>

        <div *ngFor="let ev of Object.keys(eventCounts)">
          
          <div class="event-header" (click)="toggleEvent(ev)">
            <span>{{ ev }} ({{ eventCounts[ev] }})</span>
            <span class="arrow">{{ expandedEvent === ev ? '▲' : '▼' }}</span>
          </div>

          <div *ngIf="expandedEvent === ev" class="event-details">
            <div *ngFor="let item of eventTimeline[ev]">
              <p>
                <strong>Start:</strong> {{ secondsToLabel(item.start) }}
                &nbsp;&nbsp;
                <strong>End:</strong> {{ secondsToLabel(item.end) }}
              </p>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="col">
      <div class="card">
        <h3>Trip Report</h3>

        <div class="timeline-canvas">
          <canvas id="eventTimelineChart"></canvas>
        </div>
      </div>
    </div>
  </div>


  <!-- VIDEO MODAL (unchanged) -->
  <div id="videoModal" class="video-modal" style="display:none;">
    <div class="video-modal-content">
      <span class="close-btn" (click)="closeVideo()">&times;</span>
      <video id="videoPlayer" #eventVideo width="100%" controls [src]="videoFileUrl"></video>
    </div>
  </div>


  <button class="download-btn" (click)="downloadPage()">Download Report</button>
</div>
